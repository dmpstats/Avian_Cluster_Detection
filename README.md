# Avian Cluster Detection

MoveApps

Github repository: *https://github.com/dmpstats/Avian_Cluster_Detection*

## Description

This MoveApp spatially clusters data over a rolling window, generating data on the cluster's properties (hours spent, number of revisits, number of animals, and so on). Clusters are updated with each time step to simulate real-time identification.

## Documentation

This MoveApp is intended for use on the output of **Behavioural Classification for Vultures,** and its functionality in other workflows is not guaranteed.

A spatial agglomerative clustering process is applied to all locations within the specified timeframe, over a rolling-window that 'closes' clusters after a period of inactivity. The rolling window then moves forward by the selected time-step, and repeats the clustering, iteratively until the end of the specified timeframe is reached.

For each location associated with a cluster by this process, the cluster's name is appended to the tracking data as a column named *xy.clust*. At the end of the process, a cluster-table (detailing various cluster attributes) is also generated and released as a *move2* object.

To use this process with no rolling window (i.e. perform a single clustering step of all input data):

-   Set the **cluster start date** to the earliest possible date

-   Leave the **cluster end date** null: this will default to the final date containing data
### MoveApps Worflow Dependencies

Choosing the **Use Behavioural Attribute** option requires the prior deployment of the ['Behavioural Classification for Vultures App'](https://www.moveapps.org/apps/browser/44bb2ffa-7d40-4fad-bff5-1269995ba1a2) ([Readme](https://github.com/dmpstats/Behavioural_Classification_for_Vultures)) in the workflow.

-   Set the **cluster window** to a number of days longer than the duration of your dataset (in days)

Please note: the geometry of the outputted clusters is determined by their **median location,** not mean location. This is generated using the GMedian `Weiszfeld` function.

### Input data

A `move2::move2_loc` object.

### Output data

A `move2::move2_loc` object, with appended column `xy.clust` (which cluster, if any, a location is associated with).

### Artefacts

None

### Settings


**Clustering on Entire Data** (`wholedata`): Choose whether to perform clustering over the entire span of the input data. If selected, the Starting and End dates of clustering period specified below will be ignored.

**Start Date for Clustering** (`clusterstart`) : Start date-time of period to be considered for clustering. If `NULL` (default), start date is set to 2 weeks before the latest timestamp in input data. 

**End Date for Clustering** (`clusterend`): Final date-time of period to be considered for clustering. If `NULL` (default), end date is set the latest timestamp in input data.

**Clustering Window** (`clusterwindow`) : Duration, in number of days, of the rolling time-window within which clustering is conducted. For example, setting this value to 7 (default) means clustering is applied iteratively to a 7-day rolling window.

**Clustering Time-step** (`clusterstep`): Number of days to advance between each iterative step of the rolling time-window. Defaults to a 1-day incremental step, which may be computationally demanding for large datasets. 

**Maximum Inactive Cluster Duration** (`clusterexpiration`): Number of days of inactivity after which a cluster is considered 'closed'. That is, if no new location has been added to a given cluster for this duration, no further locations will be allocated to that cluster.

**Use Behavioural Attribute** (`behavsystem`): Choose whether to consider animal behaviour in the analysis. If selected, clustering is restricted to stationary-type classified locations (e.g. feeding, resting or roosting). Otherwise, clustering includes all available data. Note: this option requires prior deployment of the 'Behavioural Classification for Vultures' App in the workflow.

**Agglomerative Clustering Cut-Height** (`d`): The height at which to cut the dendrogram generated by the hierarchical clustering process.

**Cluster ID Prefix** (`clustercode`): Optional prefix to add to automatically generated cluster ID codes. For instance, setting it to 'A' (default) results in clusters labelled 'A.1', 'A.2', etc. Useful for post-processing, e.g. merging outputs from different datasets or studies.



### Most common errors

The app will halt processing and return an error under the following conditions:

- Selecting **Use Behavioural Attribute** when column `behav` is not present in the input dataset. Column `behav` is created in the App 'Behavioural Classification for Vultures', which must be deployed earlier in the workflow.

- Specifying a **Start** or **End Date for Clustering** outside the time-period covered by the input data.

- Selecting a **Clustering Time-step** larger than **Clustering Window**, as that would lead to data being skipped between consecutive steps of the iterative clustering process.

In addition, if the input data has significantly large or small gaps between events, adjusting the **Clustering Time-step** and **Clustering Window** is essential. Otherwise, outputs can either miss out potential clusters, or perform too few iterations.


### Null or error handling

- **Start Date for Clustering**: If `NULL`, start date will be set to two weeks prior to the latest timestamp of the input data.

- **End Date for Clustering**: If `NULL`, end date will be set to the latest timestamp of the input data.
